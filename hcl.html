<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HCl Reaction Calculator</title>
<style>
body {
  margin: 0;
  font-family: "Poppins", sans-serif;
  background: linear-gradient(135deg, #004e92, #000428);
  color: white;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  transition: background 0.5s, color 0.5s;
}
body.dark {
  background: linear-gradient(135deg, #1e1e2f, #111);
  color: #eee;
}
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 25px;
  font-size: 1.2em;
  font-weight: bold;
}
.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}
.switch input { display:none; }
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #ccc;
  border-radius: 34px;
  transition: .4s;
}
.slider:before {
  position: absolute;
  content: "";
  height: 18px; width: 18px;
  left: 3px; bottom: 3px;
  background-color: white;
  border-radius: 50%;
  transition: .4s;
}
input:checked + .slider { background-color: #2196F3; }
input:checked + .slider:before { transform: translateX(26px); }

main {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
}
.calculator {
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(10px);
  padding: 35px 30px;
  border-radius: 15px;
  box-shadow: 0 0 25px rgba(0,0,0,0.4);
  width: 320px;
  text-align: center;
  transition: all 0.4s ease;
}
input{
  width: 90%;
  padding: 10px;
  margin: 8px 0;
  border: none;
  border-radius: 8px;
  font-size: 15px;
  outline: none;
  transition: 0.3s;
}
  select {
  width: 96%;
  padding: 10px;
  margin: 8px 0;
  border: none;
  border-radius: 8px;
  font-size: 15px;
  outline: none;
  transition: 0.3s;
}
input:focus, select:focus { transform: scale(1.05); }

button {
  width: 95%;
  padding: 10px;
  background: linear-gradient(135deg, #0072ff, #6a5acd);
  border: none;
  border-radius: 10px;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  margin-top: 10px;
  transition: 0.3s;
}
button:hover { transform: scale(1.05); }

.result {
  margin-top: 20px;
  font-size: 1.1em;
  font-weight: bold;
}
.table-container {
  margin-top: 30px;
  width: 90%;
  max-width: 1000px;
  overflow-x: auto;
}
table {
  width: 100%;
  border-collapse: collapse;
  color: white;
}
th, td {
  padding: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  text-align: center;
}
th { background: rgba(255,255,255,0.2); }
footer {
  text-align: center;
  padding: 10px;
  font-size: 0.9em;
  opacity: 0.8;
}
.action-btns {
  display: flex;
  gap: 10px;
  margin: 15px;
  justify-content: center;
}
.action-btns button {
  width: auto;
  padding: 8px 15px;
}

/* Print Style */
@media print {
  body { background: white; color: black; }
  header, .action-btns, footer, .calculator, #filterInput { display: none; }
  table { color: black; border: 1px solid black; }
  th, td { border: 1px solid black; }
}
</style>
</head>
<body>

<header>
  <span>‚öóÔ∏è HCl Concentration by (T & SG)</span>
  <label class="switch">
    <input type="checkbox" id="themeToggle">
    <span class="slider"></span>
  </label>
</header>

<main>
  <div class="calculator">
    <h2>Calculate Concentration of HCl</h2>
    <input type="number" id="temp" placeholder="Enter Temperature (¬∞C)">
    <input type="number" id="sghcl" placeholder="Enter Specific Gravity (SG)">
    <input type="number" id="ml" placeholder="Enter Thiosulfate Volume (ml)">
    <select id="plant">
      <option value="">-- Select Plant --</option>
      <option>15 TPD</option>
      <option>25 TPD</option>
      <option>35 TPD</option>
      <option>60 TPD</option>
    </select>
    <button onclick="calculate()">Calculate</button>
    <div class="result" id="result"></div>
  </div>

  <div class="action-btns">
    <button onclick="shareData()">üì§ Share</button>
    <button onclick="downloadPDF()">üìÑ PDF</button>
    <button onclick="printTable()">üñ® Print</button>
    <button onclick="deleteAll()">üóëÔ∏è Delete All</button>
  </div>

  <input type="text" id="filterInput" placeholder="üîç Filter by Date, Plant, Temp, or SG..." style="width:70%;padding:10px;margin:10px;border:none;border-radius:8px;text-align:center;">

  <div class="table-container">
    <table id="dataTable">
      <thead>
        <tr>
          <th>Sl. No.</th>
          <th>Date & Time</th>
          <th>Plant</th>
          <th>Temp (¬∞C)</th>
          <th>SG</th>
          <th>ml</th>
          <th>HCl Conc (%)</th>
          <th>Free Cl (ppm)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<footer>¬© 2025 Chemical Converter | All Rights Reserved</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// Theme toggle
const toggle = document.getElementById('themeToggle');
if(localStorage.theme === 'dark'){ document.body.classList.add('dark'); toggle.checked = true; }
toggle.addEventListener('change',()=>{
  document.body.classList.toggle('dark', toggle.checked);
  localStorage.theme = toggle.checked ? 'dark' : 'light';
});
  
// Helper
function read(id){ return parseFloat(document.getElementById(id).value); }

let data = JSON.parse(localStorage.getItem("hcl_data") || "[]");
renderTable();

function calculate(){
  const T = read("temp"), SG = read("sghcl"), ML = read("ml");
  const plant = document.getElementById("plant").value;
  const res = document.getElementById("result");

  if(isNaN(T) || isNaN(SG) || isNaN(ML) || plant === ""){
    res.innerHTML = "‚ö†Ô∏è Please fill all fields (including Plant).";
    return;
  }

  const conc = (((T - 20) * 0.00065 + SG) - 1) * 200;
  const free_cl = ML * 7;

  // Custom date-time format
  const now = new Date();
  const hours = String(now.getHours()).padStart(2,'0');
  const minutes = String(now.getMinutes()).padStart(2,'0');
  const day = String(now.getDate()).padStart(2,'0');
  const month = String(now.getMonth()+1).padStart(2,'0');
  const year = now.getFullYear();
  const dateTime = `${day}/${month}/${year} , ${hours}:${minutes}`;

  const record = { dateTime, plant, T, SG, ML, conc: conc.toFixed(2), free_cl: free_cl.toFixed(2) };
  data.push(record);
  localStorage.setItem("hcl_data", JSON.stringify(data));
  res.innerHTML = `
    ‚úÖ <b>Results:</b><br>
    <b>Plant:</b> ${plant}<br>
    HCl Concentration = <b>${conc.toFixed(2)}%</b><br>
    Free Cl = <b>${free_cl.toFixed(2)} ppm</b>
  `;
  renderTable();
}

function renderTable(filterText = ""){
  const tbody = document.querySelector("#dataTable tbody");
  tbody.innerHTML = "";
  const filtered = data.filter(d => Object.values(d).some(v => String(v).toLowerCase().includes(filterText.toLowerCase())));
  if(filtered.length === 0){
    tbody.innerHTML = "<tr><td colspan='8' style='text-align:center'>No records found</td></tr>";
    return;
  }
  filtered.forEach((d,i)=>{
    tbody.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${d.dateTime}</td>
        <td>${d.plant}</td>
        <td>${d.T}</td>
        <td>${d.SG}</td>
        <td>${d.ML}</td>
        <td>${d.conc}</td>
        <td>${d.free_cl}</td>
      </tr>
    `;
  });
}

// Filter live search
document.getElementById("filterInput").addEventListener("input", e=>{
  renderTable(e.target.value);
});

// Delete all
function deleteAll(){
  if(confirm("Are you sure you want to delete all data?")){
    data = [];
    localStorage.removeItem("hcl_data");
    renderTable();
  }
}

// Share data
function shareData(){
  let text = "HCl Data Records:\n";
  data.forEach((d,i)=>{
    text += `${i+1}. [${d.dateTime}] Plant=${d.plant} | Temp=${d.T} | SG=${d.SG} | ml=${d.ML} | Conc=${d.conc}% | Free Cl=${d.free_cl} ppm\n`;
  });
  navigator.clipboard.writeText(text);
  alert("‚úÖ Data copied to clipboard!");
}

// PDF
async function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: "portrait", unit: "pt", format: "a4" });
  doc.setFont("Helvetica", "bold");
  doc.setFontSize(16);
  doc.text("Saved Calculations", 40, 50);

  const headers = ["#", "Date & Time", "Plant", "Temp", "SG", "ml", "HCl Conc", "Free Cl"];
  const x = [40, 100, 220, 300, 340, 380, 440, 510];
  doc.setFontSize(12); doc.setFont("Helvetica","bold");
  headers.forEach((h,i)=> doc.text(h, x[i], 90));
  doc.line(40,95,550,95);

  let y=115;
  doc.setFont("Helvetica","normal");
  data.forEach((d,i)=>{
    const vals=[i+1,d.dateTime,d.plant,d.T,d.SG,d.ML,d.conc,d.free_cl];
    vals.forEach((v,idx)=> doc.text(String(v), x[idx], y));
    y+=25; doc.line(40,y-10,550,y-10);
  });
  doc.save("Saved_Calculations.pdf");
}

// Print view
function printTable(){
  window.print();
}
</script>
</body>
</html>